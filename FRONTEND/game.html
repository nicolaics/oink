<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>PICO</title>
    <link rel="stylesheet" href="main_loan_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <div class="container">
        <header>
            <h1><i class="fa-solid fa-landmark"></i> PICO BANK</h1>
        </header>

        <main>

 <!-- Savings Account Section -->
 <section class="account-info">
    <h2>Savings</h2>
    <p id="savingsAccountNumber">Account No: <i class="fa-solid fa-spinner fa-spin"></i></p>
    <p id="savingsAmount"><i class="fa-solid fa-spinner fa-spin"></i></p>
</section>


            <div class="container" style="height: 150%; margin:7%">
                <h2 style="text-align: center; color:#6200ea">Leaderboard</h1>
                <h4 style="text-align: center;">Month: January</h4>
                <canvas id="leaderboardChart" width="800" height="400"></canvas></div>
                <script>
                    // Generate 100 users and random scores
                    const users = Array.from({ length: 100 }, (_, i) => `User ${i + 1}`);
                    const scores = users.map(() => Math.floor(Math.random() * 100));
                
                    // Combine users and scores into an array of objects
                    const leaderboard = users.map((user, index) => ({
                        user: user,
                        score: scores[index]
                    }));
                
                    // Sort the leaderboard by score in decreasing order
                    leaderboard.sort((a, b) => b.score - a.score);
                
                    // Define the indices
                    const topCount = 6;
                    const bottomCount = 3;
                
                    // Extract the top 6 users, the current user (assume "User 57"), and the bottom 3 users
                    const top6 = leaderboard.slice(0, topCount);
                    const bottom3 = leaderboard.slice(-bottomCount);
                
                    // Find the index of the current user
                    const currentUserIndex = leaderboard.findIndex(entry => entry.user === 'User 57');
                    const currentUser = leaderboard[currentUserIndex];
                
                    // Ensure the current user is between topCount and the start of bottomCount users
                    const positionAfterTop = topCount;
                    const positionBeforeBottom = leaderboard.length - bottomCount;
                
                    if (currentUserIndex <= positionAfterTop || currentUserIndex >= positionBeforeBottom) {
                        // If the current user is in top 6 or bottom 3, reposition them
                        // Ensure the current user is in between the top and bottom
                        const adjustedPosition = positionAfterTop + (bottomCount > 1 ? Math.floor((bottomCount - 1) / 2) : 0);
                        // Insert the current user at the adjusted position
                        leaderboard.splice(adjustedPosition, 0, leaderboard.splice(currentUserIndex, 1)[0]);
                    }
                
                    // Re-calculate the sliced arrays after repositioning
                    const updatedCurrentIndex = leaderboard.findIndex(entry => entry.user === 'User 57');
                    const displayedUsers = [
                        ...top6,
                        { user: '...', score: 0 },
                        leaderboard[updatedCurrentIndex],
                        { user: '...', score: 0 },
                        ...bottom3
                    ];
                
                    // Function to convert index to ordinal
                    const ordinal = (n) => {
                        const suffixes = ["th", "st", "nd", "rd"];
                        const value = n % 100;
                        return n + (suffixes[(value - 20) % 10] || suffixes[value] || suffixes[0]);
                    };
                
                    // Generate ordinal labels for the chart
                    const positionLabels = displayedUsers.map((entry, index) => {
                        if (entry.user === '...') {
                            return ''; // Empty string for spacers
                        }
                        // Return the actual position with ordinal suffix
                        const pos = leaderboard.findIndex(user => user.user === entry.user) + 1;
                        return ordinal(pos);
                    });
                
                    const displayedScores = displayedUsers.map(entry => entry.score);
                
                    // Creating the chart
                    const ctx = document.getElementById('leaderboardChart').getContext('2d');
                    const leaderboardChart = new Chart(ctx, {
                        type: 'bar', // Type of chart
                        data: {
                            labels: positionLabels, // Y-axis labels with positions
                            datasets: [{
                                label: 'Leaderboard', // Chart label
                                data: displayedScores, // X-axis data (for horizontal bar)
                                backgroundColor: function(context) {
                                    // Highlight the current user's bar and leave gaps for spacers
                                    if (displayedUsers[context.dataIndex].user === '...') {
                                        return 'rgba(0, 0, 0, 0)'; // Transparent for spacers
                                    } else if (displayedUsers[context.dataIndex].user === 'User 57') {
                                        return 'rgba(255, 99, 132, 0.8)';
                                    } else {
                                        return 'rgba(75, 192, 192, 0.8)';
                                    }
                                },
                                borderColor: function(context) {
                                    // Outline color for each bar
                                    if (displayedUsers[context.dataIndex].user === '...') {
                                        return 'rgba(0, 0, 0, 0)'; // No border for spacers
                                    } else if (displayedUsers[context.dataIndex].user === 'User 57') {
                                        return 'rgba(255, 99, 132, 1)';
                                    } else {
                                        return 'rgba(75, 192, 192, 1)';
                                    }
                                },
                                borderWidth: 1,
                            }]
                        },
                        options: {
                            indexAxis: 'y', // Switch to horizontal bar
                            scales: {
                                x: {
                                    beginAtZero: true, // X-axis starts at zero
                                    display: false, // Hide the x-axis completely
                                    grid: {
                                        display: false // Hide x-axis grid lines
                                    }
                                },
                                y: {
                                    grid: {
                                        display: false // Hide y-axis grid lines
                                    },
                                    ticks: {
                                        padding: 10, // Increase space between labels
                                        autoSkip: false // Ensure all labels are shown
                                    }
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false // Hide the legend
                                }
                            },
                            elements: {
                                bar: {
                                    barThickness: 20, // Adjust bar width
                                    categoryPercentage: 0.5, // Reduce the bar spacing relative to the category width
                                    barPercentage: 0.8, // Reduce the bar width relative to the category width
                                    borderSkipped: false // Show border on all sides of the bar
                                }
                            }
                        }
                    });
                </script>
                </body>
</html>

        </main>
    </div>

    <!-- Bottom Menu -->
    <nav class="bottom-menu">
        <button class="menu-button" title="Loan" id="loanButton"><i class="fa-solid fa-handshake-simple"></i></button>
        <button class="menu-button" title="Home" id="homeButton"><i class="fa fa-home"></i></button>
        <button class="menu-button" title="Game" id="gameButton"><i class="fa-solid fa-piggy-bank"></i></button>
        <button class="menu-button" title="Settings" id="settingsButton"><i class="fa fa-bars"></i></button>
    </nav>

    <script src="app.js"></script>
</body>
</html>
