<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>PICO</title>
    <link rel="stylesheet" href="main_loan_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <div class="container">
        <header>
            <h1><i class="fa-solid fa-piggy-bank"></i> PICO BANK</h1>
        </header>

        <main>

 <!-- Savings Account Section -->
 <section class="account-info">
    <h2>Savings</h2>
    <p id="savingsAccountNumber">Account No: <i class="fa-solid fa-spinner fa-spin"></i></p>
    <p id="savingsAmount"><i class="fa-solid fa-spinner fa-spin"></i>â‚©</p>
</section>


            <div class="container" style="height: 150%; margin:7%">
                <h2 style="text-align: center; color:#6200ea">Leaderboard</h1>
                <h4 style="text-align: center;">Month: August</h4>
                <canvas id="leaderboardChart" width="800" height="400"></canvas></div>
                <script>
                    // Define fixed users and their scores
                    const top6Users = ['User 1', 'User 2', 'User 3', 'User 4', 'User 5', 'User 6'];
                    const top6Scores = [100, 85, 77, 50, 50, 50];
                    const bottom3Users = ['User 98', 'User 99', 'User 100'];
                    const bottom3Scores = [10, 5, 1];
                    const currentUser = 'User 37'; // Ensure the current user is at the 37th position
                    const currentUserScore = 35;
                
                    // Create the leaderboard array with fixed values
                    const top6 = top6Users.map((user, index) => ({ user, score: top6Scores[index] }));
                    const bottom3 = bottom3Users.map((user, index) => ({ user, score: bottom3Scores[index] }));
                
                    // Create a list of placeholder users between top 6 and current user
                    const numUsersBetween = 37 - 6 - 1; // Number of placeholder users between top 6 and current user
                    const placeholderUsers = Array.from({ length: numUsersBetween }, (_, i) => `User ${i + 7}`);
                    const placeholderScores = Array(numUsersBetween).fill(30); // Arbitrary score for placeholder users
                
                    // Combine all parts of the leaderboard
                    let leaderboard = [
                        ...top6,
                        ...placeholderUsers.map((user, index) => ({ user, score: placeholderScores[index] })),
                        { user: currentUser, score: currentUserScore },
                        ...bottom3
                    ];
                
                    // Sort the leaderboard by score in decreasing order
                    leaderboard.sort((a, b) => b.score - a.score);
                
                    // Ensure the currentUser is at the 37th position (zero-based index 36)
                    let currentUserIndex = leaderboard.findIndex(user => user.user === currentUser);
                    if (currentUserIndex !== -1) {
                        // Remove the currentUser from its initial position
                        let [currentUserEntry] = leaderboard.splice(currentUserIndex, 1);
                
                        // Insert the currentUser at the 37th position (zero-based index 36)
                        const targetIndex = 20; // 37th position in zero-based index
                        leaderboard.splice(targetIndex, 0, currentUserEntry);
                    }
                
                    // Create the combined data set with spacing
                    const displayedUsers = [
                        ...leaderboard.slice(0, 6), // Top 6
                        { user: '...', score: 0 },  // Spacer
                        { user: currentUser, score: currentUserScore }, // Current user
                        { user: '...', score: 0 },  // Spacer
                        ...leaderboard.slice(-3) // Bottom 3
                    ];
                
                    const displayedScores = displayedUsers.map(entry => entry.score);
                
                    // Function to convert index to ordinal
                    const ordinal = (n) => {
                        const suffixes = ["th", "st", "nd", "rd"];
                        const value = n % 100;
                        return n + (suffixes[(value - 20) % 10] || suffixes[value] || suffixes[0]);
                    };
                
                    // Generate ordinal labels for the chart
                    const positionLabels = displayedUsers.map((entry) => {
                        if (entry.user === '...') {
                            return ''; // Empty string for spacers
                        }
                        // Find the position of the user in the original leaderboard
                        const pos = leaderboard.findIndex(user => user.user === entry.user) + 1;
                        return ordinal(pos);
                    });
                
                    // Creating the chart
                    const ctx = document.getElementById('leaderboardChart').getContext('2d');
                    const leaderboardChart = new Chart(ctx, {
                        type: 'bar', // Type of chart
                        data: {
                            labels: positionLabels, // Y-axis labels with positions
                            datasets: [{
                                label: 'Leaderboard', // Chart label
                                data: displayedScores, // X-axis data (for horizontal bar)
                                backgroundColor: function(context) {
                                    // Highlight the current user's bar and leave gaps for spacers
                                    if (displayedUsers[context.dataIndex].user === '...') {
                                        return 'rgba(0, 0, 0, 0)'; // Transparent for spacers
                                    } else if (displayedUsers[context.dataIndex].user === currentUser) {
                                        return 'rgba(255, 99, 132, 0.8)';
                                    } else {
                                        return 'rgba(75, 192, 192, 0.8)';
                                    }
                                },
                                borderColor: function(context) {
                                    // Outline color for each bar
                                    if (displayedUsers[context.dataIndex].user === '...') {
                                        return 'rgba(0, 0, 0, 0)'; // No border for spacers
                                    } else if (displayedUsers[context.dataIndex].user === currentUser) {
                                        return 'rgba(255, 99, 132, 1)';
                                    } else {
                                        return 'rgba(75, 192, 192, 1)';
                                    }
                                },
                                borderWidth: 1,
                            }]
                        },
                        options: {
                            indexAxis: 'y', // Switch to horizontal bar
                            scales: {
                                x: {
                                    beginAtZero: true, // X-axis starts at zero
                                    display: false, // Hide the x-axis completely
                                    grid: {
                                        display: false // Hide x-axis grid lines
                                    }
                                },
                                y: {
                                    grid: {
                                        display: false // Hide y-axis grid lines
                                    },
                                    ticks: {
                                        padding: 10, // Increase space between labels
                                        autoSkip: false // Ensure all labels are shown
                                    }
                                }
                            },
                            layout: {
                                padding: {
                                    top: 10,
                                    bottom: 10
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false // Hide the legend
                                }
                            },
                            elements: {
                                bar: {
                                    barThickness: 20, // Adjust bar width
                                    categoryPercentage: 0.5, // Reduce the bar spacing relative to the category width
                                    barPercentage: 0.8, // Reduce the bar width relative to the category width
                                    borderSkipped: false // Show border on all sides of the bar
                                }
                            }
                        }
                    });
                </script>
                                
                                </body>
</html>

        </main>
    </div>

    <!-- Bottom Menu -->
    <nav class="bottom-menu">
        <button class="menu-button" title="Loan" id="loanButton"><i class="fa-solid fa-handshake-simple"></i></button>
        <button class="menu-button" title="Home" id="homeButton"><i class="fa fa-home"></i></button>
        <button class="menu-button" title="Game" id="gameButton"><i class="fa-solid fa-square-poll-horizontal"></i></button>
        <button class="menu-button" title="Settings" id="settingsButton"><i class="fa fa-bars"></i></button>
    </nav>

    <script src="app.js"></script>
    <script src="game.js"></script>
</body>
</html>
