<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>PICO - Loan</title>
    <!--<link rel="icon" type="image/x-icon" href="">-->
    <link rel="stylesheet" href="main_loan_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fa-solid fa-piggy-bank"></i> PICO BANK</h1>
        </header>

        <main>
            <!-- Slider to switch between Loan and Apply -->
            <div class="slider">
                <button id="applyTab" class="slider-button active">Loan</button>
                <button id="loanTab" class="slider-button">History</button>
            </div>

            <!-- Apply Loan Section  -->
            <section id="applySection" class="content-section">
                <div class="apply-form">
                    <h2>Loan Application</h2>

                    <label for="loanAmount">Loan Amount:</label>
                    <input type="number" id="loanAmount" placeholder="Enter amount" min="0" />

                    <label for="loanDuration">Loan Duration (Months):</label>
                    <select id="loanDuration">
                        <option value="6">6 months</option>
                        <option value="12">12 months</option>
                        <option value="24">24 months</option>
                        <option value="36">36 months</option>
                    </select>

                    <div class="calculated-amount">
                        <h2>Loan Information</h2>
                        <p id="calculatedDue">0.00₩</p>
                        <p id="dueDate">Due Date:</p>
                        <button class="apply-button" title="Apply" onclick="ApplyLoan()">Apply</button>
                    </div>
                </div>
            </section>

            <!-- Loan Section (Initially Hidden)-->
            <section id="loanSection" class="content-section"  style="display: none;">
                <!--div class="loan-details">
                    <h2>Amount You Have Loaned</h2>
                    <p id="loanedAmount"><i class="fa-solid fa-spinner fa-spin"></i>₩</p>

                    <h2>Due Amount Per Month</h2>
                    <p id="duePerMonth"><i class="fa-solid fa-spinner fa-spin"></i>₩</p>
                </div>

                <hr-->

                <!-- Loan History -->
                <div class="loan-history">
                    <h2>Loan History</h2>   
                </div>
            </section>

            
        </main>
    </div>

    <!-- Bottom Menu -->
    <nav class="bottom-menu">
        <button class="menu-button" title="Loan" id="loanButton"><i class="fa-solid fa-handshake-simple"></i></button>
        <button class="menu-button" title="Home" id="homeButton"><i class="fa fa-home"></i></button>
        <button class="menu-button" title="Game" id="gameButton"><i class="fa-solid fa-square-poll-horizontal"></i></button>
        <button class="menu-button" title="Settings" id="settingsButton"><i class="fa fa-bars"></i></button>
    </nav>

    <script src="app.js"></script>
    <script src="game.js"></script>
    <script>
        const apiUrl = `http://${BACKEND_ROOT}/api/v1/loan`;
        var userId = 0;
        userId = parseInt(localStorage.getItem("userId"));
    
    fetch(apiUrl, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            userId: userId
        })
    }).then(response => response.json())
        .then(data => {           
            const contentDiv = document.getElementsByClassName('loan-history')[0]; 
            let tableHTML = `<table border="1" cellspacing="0" cellpadding="10">
                <thead>
                    <tr>
                        <th style="font-size:14px;">Start Date</th>
                        <th style="font-size:14px;">End Date</th>
                        <th style="font-size:14px;">Duration</th>
                        <th style="font-size:14px;">Amount</th>
                    </tr>
                </thead>
                <tbody>`;
                    for (let i = 0; i < data.loans.length; i++) {
                        tableHTML += `<tr>
                            <td style="font-size:14px;">${String(data.loans[i].startDate).split('T')[0]}</td>
                            <td style="font-size:14px;">${String(data.loans[i].endDate).split('T')[0]}</td>
                            <td style="font-size:14px;">${String(data.loans[i].duration)}</td>
                            <td style="font-size:14px;">₩${String(data.loans[i].amount)}</td>
                        </tr>`;
                    }
                    tableHTML += `</tbody>
                </table>`;
                contentDiv.innerHTML = tableHTML;
            })
            .catch(error => {
                console.error('Error fetching account data:', error);
            });
        </script>
    </body>
</html>
